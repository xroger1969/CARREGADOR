<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <title>Simulador de Carregamento – Carro Elétrico</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- CSS interno -->
  <style>
    * { box-sizing: border-box; }
    body { font-family: Arial, sans-serif; background: #f2f2f2; margin: 0; padding: 0; }
    .container { max-width: 720px; margin: 30px auto; background: linear-gradient(180deg, #ffffff 0%, #f9fbff 100%); padding: 28px 24px 30px 24px; border-radius: 12px; box-shadow: 0 18px 40px rgba(0,0,0,0.06); }
    h1 { font-size: 1.7rem; text-align: center; margin-bottom: 22px; color: #0f172a; letter-spacing: 0.2px; }
    .row { margin-bottom: 14px; }
    .row-inline { display: flex; gap: 12px; }
    .col { flex: 1; }
    label { font-weight: 600; display: block; color: #1f2937; margin-bottom: 4px; }
    input, select { width: 100%; padding: 9px 10px; border-radius: 8px; border: 1px solid #cbd5e1; font-size: 0.97rem; transition: border-color 0.2s ease, box-shadow 0.2s ease; background: #fff; }
    input:focus, select:focus { outline: none; border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59,130,246,0.15); }
    small { display: block; margin-top: 4px; color: #6b7280; }
    button { margin-top: 12px; width: 100%; padding: 12px; border-radius: 10px; border: none; font-size: 1rem; cursor: pointer; background: linear-gradient(90deg,#2563eb,#1d4ed8); color:#fff; font-weight:700; }
    button:hover { transform: translateY(-1px); box-shadow: 0 14px 28px rgba(37,99,235,0.22); }
    #resultado { margin-top: 18px; padding: 14px 16px; border: 1px solid #e2e8f0; border-radius: 10px; background: #f8fafc; font-size: 0.97rem; line-height: 1.5; color: #0f172a; }
    .flex-between { display:flex; justify-content:space-between; align-items:center; gap:12px; }
    .muted { color:#6b7280; font-size:0.9rem }
    @media (max-width:480px){ .row-inline{flex-direction:column;} }
  </style>
</head>
<body>
  <div class="container">
    <h1>Simulador de Carregamento – Carro Elétrico</h1>

    <!-- Capacidade da bateria -->
    <div class="row">
      <label for="bateria">Capacidade da bateria (kWh)</label>
      <input type="number" id="bateria" min="10" max="200" step="1" value="54">
      <small>(intervalo típico: 40 kWh – 80 kWh; ajustável)</small>
    </div>

    <!-- Percentagens de carga -->
    <div class="row row-inline">
      <div class="col">
        <label for="socInicial">% atual da bateria</label>
        <input type="number" id="socInicial" min="0" max="99" step="1" value="18">
      </div>
      <div class="col">
        <label for="socFinal">% alvo da bateria</label>
        <input type="number" id="socFinal" min="1" max="100" step="1" value="80">
      </div>
    </div>

    <!-- Potência de carga -->
    <div class="row">
      <label for="potencia">Potência de carga (kW)</label>
      <select id="potencia">
        <option value="2.3">2,3 kW – Tomada Schuko ~10 A</option>
        <option value="3.25" selected>3,25 kW – Wallbox / tomada dedicada</option>
        <option value="3.7">3,7 kW – Wallbox monofásico 16 A</option>
        <option value="5.75">5,75 kW – Contrato 25 A</option>
        <option value="7.4">7,4 kW – Wallbox monofásico 32 A</option>
        <option value="11">11 kW – Wallbox trifásico</option>
        <option value="22">22 kW – Wallbox trifásico 3φ</option>
        <option value="custom">Outro valor (kW)</option>
      </select>
    </div>

    <!-- Potência personalizada -->
    <div class="row" id="linhaCustom" style="display:none;">
      <label for="potenciaCustom">Introduzir potência manual (kW)</label>
      <input type="number" id="potenciaCustom" step="0.1" placeholder="Ex.: 3.2">
    </div>

    <!-- Consumo médio: modo de entrada -->
    <div class="row">
      <div class="flex-between">
        <label>Modo de consumo</label>
        <div class="muted">Escolhe a unidade</div>
      </div>
      <div style="display:flex;gap:8px;margin-top:8px;align-items:center;">
        <label style="font-weight:600"><input type="radio" name="modoConsumo" value="kwh100" id="modo_kwh100"> kWh / 100 km</label>
        <label style="font-weight:600"><input type="radio" name="modoConsumo" value="kmperkwh" id="modo_kmperkwh"> km / kWh</label>
      </div>
    </div>

    <div class="row" id="linhaConsumoKwh100">
      <label for="consumo">Consumo médio do veículo (kWh / 100 km)</label>
      <input type="number" id="consumo" min="5" max="40" step="0.1" placeholder="Ex.: 16.0" value="16.0">
      <small>Se não souberes o valor, usa ~16 kWh/100 km como referência.</small>
    </div>

    <div class="row" id="linhaConsumoKmPerKwh" style="display:none;">
      <label for="consumoKmPerKwh">Eficiência (km / kWh)</label>
      <input type="number" id="consumoKmPerKwh" min="1" max="20" step="0.01" placeholder="Ex.: 6.25">
      <small>Ex.: 6,25 km por kWh equivale a ~16 kWh/100 km.</small>
    </div>

    <div class="row">
      <label for="precoKwh">Preço da energia (€ / kWh)</label>
      <input type="number" id="precoKwh" min="0" step="0.01" placeholder="Ex.: 0,20" value="0.20">
      <small>Utiliza o valor da tua tarifa ou o preço do posto público.</small>
    </div>

    <!-- Botão -->
    <button id="btnCalcular">Calcular tempo, custo, kms</button>

    <!-- Resultado -->
    <div id="resultado">
      Introduz os dados e clica em “Calcular”.
    </div>

  </div>

  <!-- JavaScript interno -->
  <script>
    // Utilidades
    function $(id){ return document.getElementById(id); }

    function atualizarPotenciaCustom(){
      const select = $('potencia');
      const linhaCustom = $('linhaCustom');
      if(select.value === 'custom') linhaCustom.style.display = 'block'; else linhaCustom.style.display = 'none';
    }

    function mostrarModoConsumo(modo){
      $('linhaConsumoKwh100').style.display = modo === 'kwh100' ? 'block' : 'none';
      $('linhaConsumoKmPerKwh').style.display = modo === 'kmperkwh' ? 'block' : 'none';
    }

    function calcular(){
      const capacidade = parseFloat($('bateria').value);
      const socInicial = parseFloat($('socInicial').value);
      const socFinal = parseFloat($('socFinal').value);
      const selectPot = $('potencia').value;
      const precoKwh = parseFloat($('precoKwh').value);

      let potencia;
      if(selectPot === 'custom') potencia = parseFloat($('potenciaCustom').value); else potencia = parseFloat(selectPot);

      const modo = document.querySelector('input[name="modoConsumo"]:checked').value;
      let kmPorKwh;
      if(modo === 'kwh100'){
        const consumo = parseFloat($('consumo').value);
        if(isNaN(consumo) || consumo <= 0){ $('resultado').textContent = 'Indica um consumo médio válido (kWh / 100 km).'; return; }
        kmPorKwh = 100.0 / consumo;
      } else {
        const kmVal = parseFloat($('consumoKmPerKwh').value);
        if(isNaN(kmVal) || kmVal <= 0){ $('resultado').textContent = 'Indica um valor válido de km / kWh.'; return; }
        kmPorKwh = kmVal;
      }

      const resultadoDiv = $('resultado');
      // Validações
      if(isNaN(capacidade) || capacidade <= 0){ resultadoDiv.textContent = 'Verifica a capacidade da bateria.'; return; }
      if(isNaN(socInicial) || isNaN(socFinal) || socInicial < 0 || socFinal > 100 || socFinal <= socInicial){ resultadoDiv.textContent = 'Verifica os valores de percentagem (o alvo deve ser maior que o atual).'; return; }
      if(isNaN(potencia) || potencia <= 0){ resultadoDiv.textContent = 'Verifica a potência de carga (kW).'; return; }
      if(isNaN(precoKwh) || precoKwh < 0){ resultadoDiv.textContent = 'Indica um preço de energia válido (€/kWh).'; return; }

      // Energia necessária em kWh
      const deltaPercent = (socFinal - socInicial) / 100.0;
      const energiaNecessaria = capacidade * deltaPercent; // kWh
      // Tempo em horas
      const tempoHoras = energiaNecessaria / potencia;
      // Custo
      const custo = precoKwh * energiaNecessaria;
      // Horas e minutos
      const horasInteiras = Math.floor(tempoHoras);
      const minutos = Math.round((tempoHoras - horasInteiras) * 60);
      const tempoHorasArredondado = tempoHoras.toFixed(2);
      // Kms
      const kmPorHora = potencia * kmPorKwh;
      const kmsAdicionados = energiaNecessaria * kmPorKwh;

      const formatadorEuro = new Intl.NumberFormat('pt-PT',{ style:'currency', currency:'EUR' });
      const formatadorNum = new Intl.NumberFormat('pt-PT',{ minimumFractionDigits:0, maximumFractionDigits:2 });

      resultadoDiv.innerHTML = '<strong>Resultados:</strong><br>' +
        'Energia necessária: <strong>' + energiaNecessaria.toFixed(2) + ' kWh</strong><br>' +
        'Potência de carga: <strong>' + potencia.toFixed(2) + ' kW</strong><br>' +
        'Tarifa aplicada: <strong>' + formatadorEuro.format(precoKwh) + ' / kWh</strong><br>' +
        'Custo estimado: <strong>' + formatadorEuro.format(custo) + '</strong><br>' +
        'Tempo estimado: <strong>' + tempoHorasArredondado + ' horas</strong><br>' +
        'Ou aproximadamente: <strong>' + horasInteiras + ' h ' + (minutos < 10 ? '0' + minutos : minutos) + ' min</strong><br><br>' +
        '<strong>Estimativa de distância carregada:</strong><br>' +
        (modo === 'kwh100' ? ('Consumo médio: <strong>' + parseFloat($('consumo').value).toFixed(1) + ' kWh/100 km</strong><br>') : ('Eficiência: <strong>' + parseFloat($('consumoKmPerKwh').value).toFixed(2) + ' km / kWh</strong><br>')) +
        'Eficiência (km / kWh): <strong>' + formatadorNum.format(kmPorKwh) + '</strong><br>' +
        'Km carregados por hora (com ' + potencia.toFixed(2) + ' kW): <strong>' + formatadorNum.format(kmPorHora) + ' km/h</strong><br>' +
        'Km aproximados adicionados ao carregar até ' + socFinal + '%: <strong>' + formatadorNum.format(kmsAdicionados) + ' km</strong><br>' +
        '<small>(Valores teóricos; na prática podem variar por perdas, gestão da bateria e estilo de condução.)</small>';

    }

    // Inicialização
    window.addEventListener('DOMContentLoaded', ()=>{
      const selectPotencia = $('potencia'); const btnCalcular = $('btnCalcular');
      selectPotencia.addEventListener('change', atualizarPotenciaCustom);
      btnCalcular.addEventListener('click', calcular);
      // modo consumo radios
      document.querySelectorAll('input[name="modoConsumo"]').forEach(r=> r.addEventListener('change', e => mostrarModoConsumo(e.target.value)));

      // definir padrão de modo consumo
      $('modo_kwh100').checked = true; mostrarModoConsumo('kwh100');

      // Preencher consumoKmPerKwh automático se estiver vazio
      if(!$('consumoKmPerKwh').value){ const c = parseFloat($('consumo').value); if(!isNaN(c) && c>0) $('consumoKmPerKwh').value = (100.0 / c).toFixed(2); }

      // Sincronizar ao alterar consumo kWh/100 -> atualizar km/kWh
      $('consumo').addEventListener('input', ()=>{ const c = parseFloat($('consumo').value); if(!isNaN(c) && c>0) $('consumoKmPerKwh').value = (100.0/c).toFixed(2); });
      $('consumoKmPerKwh').addEventListener('input', ()=>{ const k = parseFloat($('consumoKmPerKwh').value); if(!isNaN(k) && k>0) $('consumo').value = (100.0/k).toFixed(2); });
    });
  </script>
</body>
</html>
